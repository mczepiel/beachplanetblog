montageDefine("8d02820","runtime/scene-renderer",{dependencies:["runtime/dependencies/gl-matrix","runtime/technique","runtime/pass","runtime/builtin-assets","runtime/dependencies/o3dgc"],factory:function(e,t){e("runtime/dependencies/gl-matrix");var n=e("runtime/technique").Technique,i=e("runtime/pass").ScenePass,r=e("runtime/builtin-assets").BuiltInAssets,s=e("runtime/dependencies/o3dgc");t.SceneRenderer=Object.create(Object.prototype,{loadPickingTechnique:{value:function(){var e=this,t=r.assetWithName("pickingTechnique");t.then(function(t){e.technique.rootPass.scenePassRenderer.pickingTechnique=t},function(){},function(){})}},createTechniqueIfNeeded:{value:function(){if(!this._technique){this._technique=Object.create(n).init();var e=Object.create(i).init();this._technique.passes={defaultPass:e}}}},_webGLRenderer:{value:null,writable:!0},_technique:{value:null,writable:!0},technique:{get:function(){return this._technique},set:function(e){this._technique=e}},compressedMeshDelegate:{value:{str2ab:function(e){for(var t=new ArrayBuffer(e.length),n=new Uint8Array(t),i=0,r=e.length;r>i;i++)n[i]=e.charCodeAt(i);return t},decode:function(e,t){if(e){if(t)var n=new s.BinaryStream(this.str2ab(e));else var n=new s.BinaryStream(e);var i=new s.SC3DMCDecoder,r=new s.Timer,a=new s.IndexedFaceSet;r.Tic(),i.DecodeHeader(a,n),r.Toc(),console.log("DecodeHeader time (ms) "+r.GetElapsedTime());var o=12*a.GetNCoord()+12*a.GetNNormal(),l=new ArrayBuffer(o),u=new ArrayBuffer(6*a.GetNCoordIndex()),h=0;a.GetNCoordIndex()>0&&a.SetCoordIndex(new Uint16Array(u,0,3*a.GetNCoordIndex())),a.GetNCoord()>0&&(a.SetCoord(new Float32Array(l,h,3*a.GetNCoord())),h+=12*a.GetNCoord()),a.GetNNormal()>0&&(a.SetNormal(new Float32Array(l,h,3*a.GetNNormal())),h+=12*a.GetNNormal());for(var c=a.GetNumFloatAttributes(),d=0;c>d;++d)a.GetNFloatAttribute(d)>0&&a.SetFloatAttribute(d,new Float32Array(a.GetFloatAttributeDim(d)*a.GetNFloatAttribute(d)));return r.Tic(),i.DecodePlayload(a,n),r.Toc(),a}},handleError:function(e,t){console.log("ERROR:vertexAttributeBufferDelegate:"+e+" :"+t)},decompressAttribsInner_:function(e,t,n,i,r,s,a,o){for(var l=0,u=t;n>u;u++){var h=e.charCodeAt(u);l+=h>>1^-(1&h),i[r]=o*(l+a),r+=s}},decompressIndices_:function(e,t,n,i,r){for(var s=0,a=0;n>a;a++){var o=e.charCodeAt(t++);i[r++]=s-o,0==o&&s++}},decompressMesh:function(e,t,n,i){for(var r=n.decodeScales.length,s=n.decodeOffsets,a=n.decodeScales,o=t.attribRange[0],l=t.attribRange[1],u=o,h=new Float32Array(r*l),c=0;r>c;c++){var d=u+l,m=a[c];m&&this.decompressAttribsInner_(e,u,d,h,c,r,s[c],m),u=d}t.indexRange[0];var p=3*t.indexRange[1],f=new Uint16Array(p);this.decompressIndices_(e,u,p,f,0),i(h,f,null,t)},convert:function(e,t,n){var i=n.mesh.compression;if("won-compression"==i.type){var r=i.indexRange;r&&(r[0]+3*r[1],this.decompressMesh(t,i,i,function(e,t){n.renderer.setupCompressedMesh(n.mesh,e,t)}))}else{var s=0;if(n.mesh,i.compressedData){var a=i.compressedData;s=a.verticesCount;var o=this.decode(t,"ascii"===a.mode),l=o.GetCoordIndex(),u=o.GetCoord(),h=o.GetNNormal()>0?o.GetNormal():null;n.renderer.setupCompressedMesh2(n.mesh,s,u,h,o,a.floatAttributesIndexes,l)}}return t},resourceAvailable:function(){}}},scene:{get:function(){return this.technique.rootPass.scene},set:function(e){var t=this,n=this.technique.rootPass.scene;n!=e&&(this.technique.rootPass.scene=e,this.scene.rootNode.apply(function(e){e.meshes&&e.meshes.forEach(function(e){if(e.compression){var n="text";e.compression.compressedData.mode&&"binary"==e.compression.compressedData.mode&&(n="arraybuffer"),e.compression.compressedData.requestType=n,t.webGLRenderer.resourceManager.getResource(e.compression.compressedData,t.compressedMeshDelegate,{mesh:e,renderer:t.webGLRenderer})}},this)},!0,null))}},webGLRenderer:{get:function(){return this._webGLRenderer},set:function(e){this._webGLRenderer=e}},init:{value:function(e){return this.webGLRenderer=e,this.createTechniqueIfNeeded(),this.loadPickingTechnique(),this}},render:{value:function(e,t){this.technique&&this.technique.execute(this.webGLRenderer,e,t)}}})}});