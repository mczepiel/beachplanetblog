montageDefine("8d02820","runtime/utilities",{dependencies:["runtime/dependencies/gl-matrix"],factory:function(e,t){e("runtime/dependencies/gl-matrix"),t.BBox=Object.create(Object.prototype,{_dirty:{value:!0,writable:!0},_size:{value:null,writable:!0},_min:{value:null,writable:!0},_max:{value:null,writable:!0},min:{get:function(){return this._min},set:function(e){this._min=e,this._dirty=!0}},max:{get:function(){return this._max},set:function(e){this._max=e,this._dirty=!0}},init:{value:function(e,t){return this.min=e,this.max=t,this}},size:{get:function(){if(this._dirty){var e=this.min,t=this.max;this._size=[t[0]-e[0],t[1]-e[1],t[2]-e[2]],this._dirty=!1}return this._size}},computeScaleFactor:{value:function(){var e=this.size,t=e[0]>e[1]?e[0]:e[1];return t=e[2]>t?e[2]:t,t=1/t}},computeUnitMatrix:{value:function(e){var t=this.size,i=this.min;null==e&&(e=[0,0,0]);var n=this.computeScaleFactor(),r=mat4.scale(mat4.identity(),[n,n,n]),s=vec3.createFrom(e[0]-(t[0]/2+i[0]),e[1]-(t[1]/2+i[1]),e[2]-(t[2]/2+i[2])),a=mat4.translate(r,[s[0],s[1],s[2]]);return a}}}),t.Utilities=Object.create(Object.prototype,{vec3Min:{value:function(e,t){t[0]<e[0]&&(e[0]=t[0]),t[1]<e[1]&&(e[1]=t[1]),t[2]<e[2]&&(e[2]=t[2])}},vec3Max:{value:function(e,t){t[0]>e[0]&&(e[0]=t[0]),t[1]>e[1]&&(e[1]=t[1]),t[2]>e[2]&&(e[2]=t[2])}},mergeBBox:{value:function(e,t){var i=e[0],n=e[1],r=t[0],s=t[1],a=[i[0]<r[0]?i[0]:r[0],i[1]<r[1]?i[1]:r[1],i[2]<r[2]?i[2]:r[2]],o=[n[0]>s[0]?n[0]:s[0],n[1]>s[1]?n[1]:s[1],n[2]>s[2]?n[2]:s[2]];return[a,o]}},computeBBOXFromVec3Array:{value:function(e){if(0===e.length)return null;for(var t=[e[0][0],e[0][1],e[0][2]],i=[e[0][0],e[0][1],e[0][2]],n=0;8>n;n++)e[n][0]<t[0]&&(t[0]=e[n][0]),e[n][1]<t[1]&&(t[1]=e[n][1]),e[n][2]<t[2]&&(t[2]=e[n][2]),e[n][0]>i[0]&&(i[0]=e[n][0]),e[n][1]>i[1]&&(i[1]=e[n][1]),e[n][2]>i[2]&&(i[2]=e[n][2]);return[t,i]}},transformBBox:{value:function(e,t){var i=e[0],n=e[1],r=0,s=1,a=2,o=mat4.multiplyVec3(t,vec3.createFrom(i[r],i[s],i[a])),l=mat4.multiplyVec3(t,vec3.createFrom(n[r],i[s],i[a])),u=mat4.multiplyVec3(t,vec3.createFrom(i[r],n[s],i[a])),h=mat4.multiplyVec3(t,vec3.createFrom(n[r],n[s],i[a])),c=mat4.multiplyVec3(t,vec3.createFrom(i[r],i[s],n[a])),d=mat4.multiplyVec3(t,vec3.createFrom(n[r],i[s],n[a])),m=mat4.multiplyVec3(t,vec3.createFrom(i[r],n[s],n[a])),p=mat4.multiplyVec3(t,vec3.createFrom(n[r],n[s],n[a]));return this.computeBBOXFromVec3Array([o,l,u,h,c,d,m,p])}},rayIntersectsMesh:{value:function(e,t,i,n,r){var s=t.verticesBuffer;if(null===s)return!1;var a=!1,o=t.primitives.length;vec3.create(),vec3.create(),vec3.create();for(var l=0;o>l;l++){var u=t.primitives[l];if(r){var h=r.materials;if(h&&-1==h.indexOf(u.material.name))continue}if(!(null!==u.material.inputs.transparency&&u.material.inputs.transparency!==void 0&&1>u.material.inputs.transparency)){var c=u.boundingBox;if(this.intersectsBBOX(c,e))return!0}}return a}},intersectsBBOX:{value:function(e,t){var i,n,r,s,a,o,l=0,u=1,h=2,c=t[1],d=t[0],m=e[0],p=e[1];return c[l]>=0?(i=(m[l]-d[l])/c[l],n=(p[l]-d[l])/c[l]):(i=(p[l]-d[l])/c[l],n=(m[l]-d[l])/c[l]),c[u]>=0?(r=(m[u]-d[u])/c[u],s=(p[u]-d[u])/c[u]):(r=(p[u]-d[u])/c[u],s=(m[u]-d[u])/c[u]),i>s||r>n?!1:(r>i&&(i=r),n>s&&(n=s),c[h]>=0?(a=(m[h]-d[h])/c[h],o=(p[h]-d[h])/c[h]):(a=(p[h]-d[h])/c[h],o=(m[h]-d[h])/c[h]),i>o||a>n?!1:(a>i&&(i=a),n>o&&(n=o),!0))}},inverpolateAxisAngle:{value:function(e,t,n,r){var s=0,a=1,o=2,l=a,u=e,h=t;if(l==s){vec3.normalize(u),vec3.normalize(h);var c=vec3.create();vec3.cross(u,h,c),Math.sqrt(vec3.dot(u,u)),Math.sqrt(vec3.dot(h,h));var d=Math.acos(vec3.dot(u,h)),m=mat4.identity();mat4.rotate(m,d*n,c),mat4.multiplyVec3(m,u,c),vec3.normalize(c);var p=u[3]+(h[3]-u[3])*n;quat4.fromAngleAxis(p,c,r)}else if(l==a){for(i=0;r.length>i;i++){var f=u[i],_=h[i];h[i]=f+(_-f)*n}quat4.fromAngleAxis(h[3],h,r)}else l==o&&quat4.slerp(e,t,n,r)}},interpolateVec:{value:function(e,t,n,r){for(i=0;r.length>i;i++){var s=e[i],a=t[i];r[i]=s+(a-s)*n}}},idx:{value:function(e,t){return 4*e+t}},decomposeMat4:{value:function(e,t,i,n){var r,s,a=mat4.create(),o=mat4.create();mat4.create(),mat4.create();var l=[vec3.create(),vec3.create(),vec3.create()];mat4.set(e,a);var u,h;for(r=0;4>r;r++)for(s=0;4>s;s++)u=this.idx(r,s),h=this.idx(3,3),a[u]/=a[h];for(mat4.set(a,o),r=0;3>r;r++)u=this.idx(r,3),o[u]=0;for(u=this.idx(3,3),o[u]=1,(0!=a[this.idx(0,3)]||0!=a[this.idx(1,3)]||0!=a[this.idx(2,3)])&&(a[this.idx(0,3)]=0,a[this.idx(1,3)]=0,a[this.idx(2,3)]=0,a[this.idx(3,3)]=1),t&&(t[0]=a[this.idx(3,0)],t[1]=a[this.idx(3,1)],t[2]=a[this.idx(3,2)]),a[this.idx(3,0)]=0,a[this.idx(3,1)]=0,a[this.idx(3,2)]=0,r=0;3>r;r++)l[r][0]=a[this.idx(r,0)],l[r][1]=a[this.idx(r,1)],l[r][2]=a[this.idx(r,2)];null!=n&&(n[0]=vec3.length(l[0]),n[1]=vec3.length(l[1]),n[2]=vec3.length(l[2])),vec3.normalize(l[0]),vec3.normalize(l[1]),vec3.normalize(l[2]);var c=vec3.create();if(vec3.cross(l[1],l[2],c),0>vec3.dot(l[0],c))for(r=0;3>r;r++)null!=n&&(n[r]*=-1),l[r][0]*=-1,l[r][1]*=-1,l[r][2]*=-1;null!=i&&(i[0]=.5*Math.sqrt(Math.max(1+l[0][0]-l[1][1]-l[2][2],0)),i[1]=.5*Math.sqrt(Math.max(1-l[0][0]+l[1][1]-l[2][2],0)),i[2]=.5*Math.sqrt(Math.max(1-l[0][0]-l[1][1]+l[2][2],0)),i[3]=.5*Math.sqrt(Math.max(1+l[0][0]+l[1][1]+l[2][2],0)),l[2][1]>l[1][2]&&(i[0]=-i[0]),l[0][2]>l[2][0]&&(i[1]=-i[1]),l[1][0]>l[0][1]&&(i[2]=-i[2]))}}})}});