montageDefine("bfd16e7","core/serialization/deserializer/serialization-extractor",{dependencies:["core/core","./montage-reviver","frb/parse"],factory:function(e,t){var n=e("core/core").Montage,i=e("./montage-reviver").MontageReviver,r=e("frb/parse"),a=n.specialize({_serialization:{value:null},initWithSerialization:{value:function(e){this._serialization=e}},extractObjects:{value:function(e,t){var n=this._serialization,i={};t=t||[];for(var r,a=0;r=e[a];a++)r in n&&(i[r]=n[r],this._findLabels(r,t));for(var r,a=0;r=t[a];a++)!(r in i)&&r in n&&(i[r]={});return JSON.parse(JSON.stringify(i))}},_findLabels:{value:function(e,t){var n;if(-1===t.indexOf(e)){if(!(e in this._serialization))throw Error("Object '"+e+"' not found.");t.push(e),n=this._serialization[e],this._collectLabels(n,t),this._collectLabelsInUnits(n,t)}}},_collectLabels:{value:function(e,t){var n,r=i.getTypeOf(e);if("reference"===r)n=e["@"],this._findLabels(n,t);else if("array"===r)for(var a=0,s=e.length;s>a;a++)this._collectLabels(e[a],t);else if("object"===r)for(var o in e)this._collectLabels(e[o],t)}},_collectLabelsInUnits:{value:function(e,t){"bindings"in e?this._collectLabelsInBindings(e.bindings,t):"localizations"in e&&this._collectLabelsInLocalizations(e.localizations,t)}},_collectLabelsInBindings:{value:function(e,t){var n,i;for(var r in e)n=e[r],i=n["<-"]||n["<->"],this._collectLabelsInBindingPath(i,t)}},_collectLabelsInBindingPath:{value:function(e,t){var n=this,i=r(e);this._traverseBindingParseTree(i,function(e){n._findLabels(e.label,t)})}},_traverseBindingParseTree:{value:function(e,t){var n=e.args;if("component"===e.type&&t(e),n)for(var i=0,r=n.length;r>i;i++)this._traverseBindingParseTree(n[i],t)}},_collectLabelsInLocalizations:{value:function(e,t){for(var n in e)this._collectLabelsInLocalizationProperty(e[n],t)}},_collectLabelsInLocalizationProperty:{value:function(e,t){var n;if("key"in e&&this._collectLabelsInLocalizationBinding(e.key,t),"default"in e&&this._collectLabelsInLocalizationBinding(e.default,t),"data"in e){n=e.data;for(var i in n)this._collectLabelsInLocalizationBinding(n[i],t)}}},_collectLabelsInLocalizationBinding:{value:function(e,t){var n=e["<-"]||e["<->"];n&&this._collectLabelsInBindingPath(n,t)}}});t.SerializationExtractor=a}});